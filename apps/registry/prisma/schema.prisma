datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator erd {
  provider = "prisma-erd-generator"
  output   = "../../../docs/registry/assets/erd.md"
}

/// OP 文書
model Op {
  id          Int          @id
  /// 認証機構
  certifier   Account      @relation(fields: [certifierId], references: [id])
  certifierId Int
  /// 発行日
  issuedAt    DateTime
  /// 有効期限
  expiredAt   DateTime
  /// JWT
  jwt         String       @unique
  /// 公開
  publication Publication?
}

/// 会員
model Account {
  id               Int                @id
  /// ウェブサイトのURL
  url              String             @unique
  /// 会員種別
  role             Role
  /// 法人名
  name             String
  /// 説明 (ウェブメディアそれを運用する法人、認定機関、業界団体等であることの記述)
  description      String
  /// 事業種目
  businessCategory BusinessCategory[]
  /// メールアドレス
  email            String
  /// 電話番号
  phoneNumber      String
  /// 郵便番号
  postalCode       String
  /// 国
  addressCountry   String
  /// 都道府県
  addressRegion    String
  /// 市区町村
  addressLocality  String
  /// 番地・ビル名
  addressStreet    String
  /// ロゴ画像のURL
  logo             String
  /// 発行履歴
  issue            Op[]
  /// 公開履歴
  publication      Publication[]
  /// 公開鍵
  key              Key[]
}

/// 会員種別
enum Role {
  /// 組織
  GROUP
  /// 認証機構
  CERTIFIER
}

/// 事業種目
model BusinessCategory {
  id      Int       @id
  /// 事業種目
  value   String    @unique
  /// 会員
  account Account[]
}

/// 公開
model Publication {
  /// OP 文書
  op          Op       @relation(fields: [opId], references: [id])
  opId        Int      @id
  /// 会員
  account     Account  @relation(fields: [accountId], references: [id])
  accountId   Int
  /// 公開日
  publishedAt DateTime
}

/// 公開鍵
model Key {
  id        Int     @id
  /// 会員
  account   Account @relation(fields: [accountId], references: [id])
  accountId Int
  /// JWK
  jwk       Json
}
