import { FastifySchema, FastifyRequest, FastifyReply } from "fastify";
import { ContextDefinition, JsonLdDocument } from "jsonld";
import context from "@originator-profile/model/context.json" assert { type: "json" };
import Params from "./params";

const schema: FastifySchema = {
  operationId: "getDocumentProfileSet",
  tags: ["profiles"],
  description: "特定のウェブページ ID の Profile Set の取得",
  params: Params,
  produces: ["application/ld+json"],
  response: {
    200: {
      title: "Profile Set",
      description: "Profile Set",
      type: "object",
      additionalProperties: true,
      example: {
        "@context": "https://originator-profile.org/context.jsonld",
        main: "ef9d78e0-d81a-4e39-b7a0-27e15405edc7",
        profile: [
          "eyJhbGciOiJFUzI1NiIsImtpZCI6ImpKWXM1X0lMZ1VjODE4MEwtcEJQeEJwZ0EzUUM3ZVp1OXdLT2toOW1ZUFUiLCJ0eXAiOiJKV1QifQ.eyJodHRwczovL29yaWdpbmF0b3ItcHJvZmlsZS5vcmcvb3AiOnsiaXRlbSI6W3sidHlwZSI6ImNyZWRlbnRpYWwiLCJ1cmwiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvY2VydGlmaWNhdGlvbi1zeXN0ZW1zLzk1ZGNlYjZjLWY2YWEtNGI3MC1hYTVhLTBiYTljMzE0OTBmZiIsIm5hbWUiOiJKSUNEQVEg44OW44Op44Oz44OJ44K744O844OV44OG44Kj6KqN6Ki8IOiHquW3seWuo-iogCIsImltYWdlIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2NyZWRlbnRpYWwtYnJhbmQtc2FmZXR5LWNlcnRpZmllZC5wbmciLCJpc3N1ZWRBdCI6IjIwMjQtMTEtMDdUMDI6MDk6NTUuNDQ3WiIsImV4cGlyZWRBdCI6IjIwMjUtMTEtMDdUMDI6MDk6NTUuNDQ3WiIsImNlcnRpZmllciI6ImxvY2FsaG9zdCIsInZlcmlmaWVyIjoibG9jYWxob3N0In0seyJ0eXBlIjoiY2VydGlmaWVyIiwiZG9tYWluTmFtZSI6ImxvY2FsaG9zdCIsInVybCI6Imh0dHBzOi8vb3JpZ2luYXRvci1wcm9maWxlLm9yZy8iLCJuYW1lIjoiT3JpZ2luYXRvciBQcm9maWxlIOaKgOihk-eglOeptue1hOWQiCAo6ZaL55m655SoKSIsImNvcnBvcmF0ZU51bWJlciI6IjgwMTAwMDUwMzU5MzMiLCJwb3N0YWxDb2RlIjoiMTAwLTgwNTUiLCJhZGRyZXNzQ291bnRyeSI6IkpQIiwiYWRkcmVzc1JlZ2lvbiI6IuadseS6rOmDvSIsImFkZHJlc3NMb2NhbGl0eSI6IuWNg-S7o-eUsOWMuiIsInN0cmVldEFkZHJlc3MiOiLlpKfmiYvnlLoxLTctMSIsImNvbnRhY3RUaXRsZSI6IuOBiuWVj-OBhOWQiOOCj-OBmyIsImNvbnRhY3RVcmwiOiJodHRwczovL29yaWdpbmF0b3ItcHJvZmlsZS5vcmcvamEtSlAvaW5xdWlyeS8iLCJwcml2YWN5UG9saWN5VGl0bGUiOiLjg5fjg6njgqTjg5Djgrfjg7zjg53jg6rjgrfjg7wiLCJwcml2YWN5UG9saWN5VXJsIjoiaHR0cHM6Ly9vcmlnaW5hdG9yLXByb2ZpbGUub3JnL2phLUpQL3ByaXZhY3kvIiwibG9nb3MiOlt7InVybCI6Imh0dHBzOi8vb3JpZ2luYXRvci1wcm9maWxlLm9yZy9pbWFnZS9pY29uLnN2ZyIsImlzTWFpbiI6dHJ1ZX1dLCJidXNpbmVzc0NhdGVnb3J5IjpbXX0seyJ0eXBlIjoidmVyaWZpZXIiLCJkb21haW5OYW1lIjoibG9jYWxob3N0IiwidXJsIjoiaHR0cHM6Ly9vcmlnaW5hdG9yLXByb2ZpbGUub3JnLyIsIm5hbWUiOiJPcmlnaW5hdG9yIFByb2ZpbGUg5oqA6KGT56CU56m257WE5ZCIICjplovnmbrnlKgpIiwiY29ycG9yYXRlTnVtYmVyIjoiODAxMDAwNTAzNTkzMyIsInBvc3RhbENvZGUiOiIxMDAtODA1NSIsImFkZHJlc3NDb3VudHJ5IjoiSlAiLCJhZGRyZXNzUmVnaW9uIjoi5p2x5Lqs6YO9IiwiYWRkcmVzc0xvY2FsaXR5Ijoi5Y2D5Luj55Sw5Yy6Iiwic3RyZWV0QWRkcmVzcyI6IuWkp-aJi-eUujEtNy0xIiwiY29udGFjdFRpdGxlIjoi44GK5ZWP44GE5ZCI44KP44GbIiwiY29udGFjdFVybCI6Imh0dHBzOi8vb3JpZ2luYXRvci1wcm9maWxlLm9yZy9qYS1KUC9pbnF1aXJ5LyIsInByaXZhY3lQb2xpY3lUaXRsZSI6IuODl-ODqeOCpOODkOOCt-ODvOODneODquOCt-ODvCIsInByaXZhY3lQb2xpY3lVcmwiOiJodHRwczovL29yaWdpbmF0b3ItcHJvZmlsZS5vcmcvamEtSlAvcHJpdmFjeS8iLCJsb2dvcyI6W3sidXJsIjoiaHR0cHM6Ly9vcmlnaW5hdG9yLXByb2ZpbGUub3JnL2ltYWdlL2ljb24uc3ZnIiwiaXNNYWluIjp0cnVlfV0sImJ1c2luZXNzQ2F0ZWdvcnkiOltdfSx7InR5cGUiOiJob2xkZXIiLCJkb21haW5OYW1lIjoibG9jYWxob3N0IiwidXJsIjoiaHR0cHM6Ly9vcmlnaW5hdG9yLXByb2ZpbGUub3JnLyIsIm5hbWUiOiJPcmlnaW5hdG9yIFByb2ZpbGUg5oqA6KGT56CU56m257WE5ZCIICjplovnmbrnlKgpIiwiY29ycG9yYXRlTnVtYmVyIjoiODAxMDAwNTAzNTkzMyIsInBvc3RhbENvZGUiOiIxMDAtODA1NSIsImFkZHJlc3NDb3VudHJ5IjoiSlAiLCJhZGRyZXNzUmVnaW9uIjoi5p2x5Lqs6YO9IiwiYWRkcmVzc0xvY2FsaXR5Ijoi5Y2D5Luj55Sw5Yy6Iiwic3RyZWV0QWRkcmVzcyI6IuWkp-aJi-eUujEtNy0xIiwiY29udGFjdFRpdGxlIjoi44GK5ZWP44GE5ZCI44KP44GbIiwiY29udGFjdFVybCI6Imh0dHBzOi8vb3JpZ2luYXRvci1wcm9maWxlLm9yZy9qYS1KUC9pbnF1aXJ5LyIsInByaXZhY3lQb2xpY3lUaXRsZSI6IuODl-ODqeOCpOODkOOCt-ODvOODneODquOCt-ODvCIsInByaXZhY3lQb2xpY3lVcmwiOiJodHRwczovL29yaWdpbmF0b3ItcHJvZmlsZS5vcmcvamEtSlAvcHJpdmFjeS8iLCJsb2dvcyI6W3sidXJsIjoiaHR0cHM6Ly9vcmlnaW5hdG9yLXByb2ZpbGUub3JnL2ltYWdlL2ljb24uc3ZnIiwiaXNNYWluIjp0cnVlfV0sImJ1c2luZXNzQ2F0ZWdvcnkiOltdfV0sImp3a3MiOnsia2V5cyI6W3sieCI6InlwQWxVam81TzVzb1VOSGszbWxSeWZ3NnVqeHFqZkRfSE1RdDdYSC1yU2ciLCJ5IjoiMWNtdjlsbVp2TDBYQUVSTnh2clQya1prQzRVd3U1aTFPcjFPLTRpeEp1RSIsImNydiI6IlAtMjU2Iiwia2lkIjoiakpZczVfSUxnVWM4MTgwTC1wQlB4QnBnQTNRQzdlWnU5d0tPa2g5bVlQVSIsImt0eSI6IkVDIn1dfX0sImlzcyI6ImxvY2FsaG9zdCIsInN1YiI6ImxvY2FsaG9zdCIsImlhdCI6MTczMDk0NTM5NSwiZXhwIjoyMDQ2NDc4MTk1fQ.-zJMJtSvhwxaLGpfoL49XKKqswGob2wuWHC1TmTjgXH_sVG6Xr7JNvhIMO8g-GARjZifNgamkGTwcEJGhEoQRA",
          "eyJhbGciOiJFUzI1NiIsImtpZCI6ImpKWXM1X0lMZ1VjODE4MEwtcEJQeEJwZ0EzUUM3ZVp1OXdLT2toOW1ZUFUiLCJ0eXAiOiJKV1QifQ.eyJodHRwczovL29yaWdpbmF0b3ItcHJvZmlsZS5vcmcvZHAiOnsiaXRlbSI6W3sidHlwZSI6IndlYnNpdGUiLCJ1cmwiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvIiwidGl0bGUiOiJPUCDnorroqo3jgY_jgpMiLCJpbWFnZSI6Imh0dHBzOi8vZXhhbXBsZS5jb20vaW1hZ2UucG5nIiwiZGVzY3JpcHRpb24iOiLjgZPjga7jgqbjgqfjg5bjg5rjg7zjgrjjga7oqqzmmI7jgafjgZnjgIIiLCJodHRwczovL3NjaGVtYS5vcmcvYXV0aG9yIjoi5bGx55Sw5aSq6YOOIiwiY2F0ZWdvcnkiOlt7ImNhdCI6IklBQjEiLCJjYXR0YXgiOjEsIm5hbWUiOiJBcnRzICYgRW50ZXJ0YWlubWVudCJ9XSwiaHR0cHM6Ly9zY2hlbWEub3JnL2VkaXRvciI6IuWxseeUsOiKseWtkCIsImh0dHBzOi8vc2NoZW1hLm9yZy9kYXRlUHVibGlzaGVkIjoiMjAyMy0wNy0wNFQxOToxNDowMFoiLCJodHRwczovL3NjaGVtYS5vcmcvZGF0ZU1vZGlmaWVkIjoiMjAyMy0wNy0wNFQxOToxNDowMFoifSx7InR5cGUiOiJ2aXNpYmxlVGV4dCIsInVybCI6Imh0dHA6Ly9sb2NhbGhvc3Q6ODA4MC8iLCJsb2NhdGlvbiI6ImgxIiwicHJvb2YiOnsiandzIjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJbXRwWkNJNkltcEtXWE0xWDBsTVoxVmpPREU0TUV3dGNFSlFlRUp3WjBFelVVTTNaVnAxT1hkTFQydG9PVzFaVUZVaUxDSmlOalFpT21aaGJITmxMQ0pqY21sMElqcGJJbUkyTkNKZGZRLi5fMkk0WUVEQTN5QmVnYXpwenpSMVJ4OU5yVG5tdW8wcExXT2NPWWlYUTRmSGlpSTA4YVB5LWRtemhtdVBGVkhaSWRWbm1uQm1SXzRTYXJvcTg0NmQtZyJ9fV19LCJpc3MiOiJsb2NhbGhvc3QiLCJzdWIiOiJlZjlkNzhlMC1kODFhLTRlMzktYjdhMC0yN2UxNTQwNWVkYzciLCJpYXQiOjE3MzA5NDUzOTUsImV4cCI6MjA0NjQ3ODE5NX0.pI3qNsc0RsJ9iJo4hOJ5YzoV040hzqb8s4HrPdypDCZ7gByOn2MQNEhD0i5wXcIcixhbm5syA5cDzd8OGY2gXg",
        ],
      },
    },
  },
};

async function getDocumentProfileSet(
  {
    server,
    params,
  }: FastifyRequest<{
    Params: Params;
  }>,
  reply: FastifyReply,
) {
  const contextDefinition: ContextDefinition | undefined =
    server.config.NODE_ENV === "development" ? context["@context"] : undefined;
  const data: JsonLdDocument =
    await server.services.website.getDocumentProfileSet(
      params.id,
      contextDefinition,
    );

  reply.type("application/ld+json");
  return data;
}

export default Object.assign(getDocumentProfileSet, { schema });
