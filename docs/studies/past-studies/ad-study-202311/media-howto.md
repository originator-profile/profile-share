---
sidebar_position: 2
---

# 広告連携実験、メディア側対応

## はじめに

次の全体像の図に示すとおり、[先の実験](/studies/past-studies/media-study-202307/)にて OP レジストリ登録を済ませた組織による自社記事配信サイトにおいて、OP を利用した RTB 広告取引を行う為の Google Ad Manager の広告タグを埋め込み、実際の RTB 上で OP ID などの OP 情報を利用した広告取引を行うと共に、信頼できる広告の表示(および広告取引)がされていることをどのように利用者が確認可能とするか、実際にプロトタイプ実装をして動かしながら検証、検討を進めます。

![Alt text](assets/abstract-concept.png)

全体を示すため細部省略していますが、メディア側の OP 対応基本設計は次の通りです。

![Alt text](assets/abstract-basis.png)

## OP 情報表示 UI の刷新とサイト/広告プロファイル

本実験では RTB 広告取引に於ける OP 技術利用を主目的としていますが、OP 対応広告について、記事を閲覧するユーザにも OP 対応広告の情報を表示可能になる仕組みも作ります。先の実験の段階では自社記事配信サイトであり関連する組織は 1 社に限定されていましたが、今回はメインの記事と広告の 2 社についてそれぞれの位置づけも明確にしつつ表示可能にすることと、(今後のメディア記事のプラットフォーム配信実験においても必要となる) サイト運営者とコンテンツ作成者の関係性の明確化などをするため、このタイミングで OP 情報表示 UI の改訂を行います。

Figma での検討段階の UI デザイン案 (11 月末段階) は次の通りです:

![Alt text](assets/draft-ui-202311.png)

従来は記事とその作成者の情報だけを表示していましたが、配信しているサイトと運営者の情報を上部に分けて同時に表示すると共に、記事のようなメインコンテンツ以外に広告の情報も表示可能となります。それらの情報はサイトプロファイルや広告プロファイルに記載されますが、サイトプロファイルについてはメディアサイトの運営者側での用意が必要となります。

広告プロファイルについては広告主/広告配信側で用意するため本来はメディアサイト側での対応は一切不要ですが、実証実験の仕様検討と実装の進行の都合上、実験初期段階ではメディアサイト側にダミー広告プロファイルへのリンク挿入をお願いします。

## 広告連携実験 1st ステップ対応

ここでは、2023 年 12 月中の実施を目指す広告連携実証の初回実験に於いて、メディアサイト側での対応が必要な点について説明します。この実験の概要は 12 月 4 日の説明会で示した通り、次の対応が必要です。

- 署名付きサイトプロファイルの作成と設置
- サイトを外部 (SSP = Fluct 社) からアクセス可能に
- 広告枠に GAM の広告タグを設置
- 広告枠前後に広告プロファイル表示用タグを追加
- GAM におけるスポンサーシップ広告申込情報の設定
- ads.txt で Fluct 社による広告枠販売の許可を明示

![Alt text](assets/1st-expt-overview.png)

以下、具体的な実施内容について順に説明します。

### 署名付きサイトプロファイルの作成と設置

OP 情報表示 UI の上部に表示する、サイトの情報を記載した[署名付きサイトプロファイル](/terminology/signed-site-profile.md)の作成と設置が必要です。

具体的には署名付きサイトプロファイルとその運営者の組織情報を記載した OP のペア ([Website Profile Pair](/terminology/website-profile-pair.md)) を記載した JSON ファイルであり、次のような形式のものです:

```json
{
  "@context": "https://originator-profile.org/context.jsonld",
  "website": {
    "op": {
      "iss": "oprexpt.originator-profile.org",
      "sub": "example.com",
      "profile": "<SOP の JWT>"
    },
    "dp": {
      "sub": "ca729848-9265-48bf-8e33-887a43ba34b9",
      "profile": "<署名付きサイトプロファイル>"
    }
  }
}
```

`<SOP の JWT>` に含まれる情報は OP レジストリ登録時に記載頂いたものです (変更されたい場合はレジストリ登録情報の更新作業が必要ですので都度ご連絡ください)。`<署名付きサイトプロファイル>` に含める情報は次のような JSON ファイルに記載した上で profile-registry CLI (コマンドラインツール) を用いて作成してください。

```json
{
  "id": "<UUID>",
  "title": "<サイト名>",
  "image": "<画像URL>",
  "description": "<サイトの説明>"
}
```

:::info

表示のされ方については[画像の表示](../media-study-202307/image.md)を参照してください。

:::

このファイルの作成には OP レジストリ登録時に用意した組織の秘密鍵、登録時に受け取った OP ID と SOP ファイルが必要です。それらを用意した上で、[署名付きサイトプロファイルの作成と設置手順の説明ページ](/registry/operation/website-profile-pair-installation.md)に従って作成してください。

作成できたら Profile Pair を実験サイトの `/.well-known/pp.json` (固定のパス、ファイル名) に設置して、SSP などからアクセス可能にしてください。

:::note

SSP (本実験においては Fluct) がサイトの運営者の OP ID をサイトプロファイルから読み取り (必要に応じて) 検証することでメディアサイト運営者の OP ID (とそれに紐付く OP レジストリ登録情報) の詐称を防ぐ仕組みです。信頼できる OP 対応広告取引においてはサイトプロファイルが必須です。

:::

### サイトを外部 (SSP = Fluct 社) からアクセス可能に

上記のサイトプロファイル `/.well-known/pp.json` は OP 対応 SSP などが参照可能である必要があります (MUST)。今回の実証実験をクローズドな検証環境で実行している場合、最低限、実験参加 SSP (Fluct 社) のサーバからアクセス可能にしてください。

手順についてはメディアサイト側次第ですが、誰でもアクセス可能な Public 領域とする事ができない場合、IP アドレスのアクセス制限の Allow List を更新頂く等の対応が必要です。Basic 認証や Bearer トークン認証などの場合は認証情報を頂く必要があります。

該当するメディア企業においては、個別に事務局および実験参加 SSP とのご調整をお願いします。

### 広告枠に GAM の広告タグを設置

今回の実験ではまず、国内の多くのメディアが採用している GAM (Google Ad Manager) を利用した広告配信を対象とした実験を行います。後述のスポンサーシップ広告申込情報の設定をした広告タグを、実験対象とする OP 対応サイトの任意ページの広告枠として埋め込んでください (普段から GAM を利用している箇所を推奨します)。

広告枠の大きさ (想定されるクリエイティブ) には `300x250` (横 300px × 高さ 250px) を指定してください。

一般的な GAM 広告タグの設置手順通りですが、不明点がありましたら事務局にご相談ください。

### 広告枠前後に広告プロファイル表示用タグを追加

今回の実験当初に限り、GAM 管理画面で生成した広告タグ (ドキュメント本文用のタグ) を包む形で、OP 対応広告枠の場所を特定可能にしつつ広告プロファイルの取得先が分かるようにするため、次のような形で `<div>` タグと `<link>` タグを挿入して頂きます (各社の CMS の都合など考慮して細かな変更はあり得ます)

```
<div id="{広告表示箇所ID}">
  <link href="{広告プロファイルURL}"
    rel="alternate" type="application/ld+json"/>
  {GAM 管理画面で生成したタグ}
</div>
```

`広告表示箇所ID` と `広告プロファイルURL` についてはダミー広告プロファイルの準備・作成を終え次第、本ドキュメントを更新した上で事務局から実験参加企業にご連絡いたします。

`GAM 管理画面で生成したタグ` は通常の GAM 広告の埋め込みと同様ですが、不明点がありましたら事務局にご相談ください。

:::note

本来広告の情報を記載した広告プロファイルの作成・配信などは広告主など広告の情報を持っている側で用意し、アドサーバを通じて配信される広告 HTML の中に直接またはそこから参照する形で埋め込むものですが、仕様検討と実装の調整が済むまでの実験当初に限り、ダミーの広告プロファイルをメディアサイト側で埋め込んで貰う形でブラウザでの UI 表示確認を可能として頂きます。

:::

次回以降のいずれかの実験ステップではこの作業は不要となる予定です (挿入頂いた `<div>` タグと `<link>` タグの撤去が必要になります)。

### GAM におけるスポンサーシップ広告申込情報の設定

今回の実験で利用する広告枠には OP 対応を行った SSP すなわち Fluct 社による広告配信が確実に行える環境を用意して頂く必要があります。今後の実験では OP 対応 SSP と非対応 SSP が混在した状態での取引などの実験も進めていくことになりますが、初回実験の目的は OP 対応メディア、DSP、SSP、広告主の間での RTB 処理に不具合が生じないことの疎通確認ですので、Fluct 社による広告を 100% の割合の「[スポンサーシップ](https://support.google.com/admanager/answer/177426?sjid=10197717253867185306-AP)」として設定してください。

GAM において Fluct による広告を 100% のスポンサーシップとして設定する手順は通常の GAM の管理操作と同様ですが、不明点がありましたら事務局および Fluct 社にご相談ください。

### ads.txt で Fluct 社による広告枠販売の許可を明示

Fluct 社による広告配信を許可済みのサイトであれば既に記載済みであり特に作業は不要ですが。もし実験環境が Fluct 社を広告枠販売許可する SSP として ads.txt に未記載である倍は記載の追加が必要です。

通常の RTB 取引のための準備設定と同様ですが、不明点がありましたら事務局および Fluct 社にご相談ください。

## 広告連携実験 1st ステップの実施

DSP/SSP 側と (一部) メディア側の準備が整うタイミングに合わせて、広告連携実験を実施する時間を調整・ご連絡します。
その時間に実際に各社の実験サイトへのアクセスをして意図したとおり広告 (実験用に用意する SMN 社の広告) が表示されることをご確認頂きます。

また、従来のメディア側実証実験と同様に Chrome ブラウザに OP 情報表示用の拡張機能を入れて、サイト、記事、広告の OP 情報が表示されることの確認をして頂きます。

## 広告連携実験 1st ステップの報告

実験終了後にはレポートにご協力をお願い致します。
頂きたい報告内容あるいは報告用フォームについては実験実施時までに追って連絡させて頂きます。

## 広告連携実験 2nd ステップに向けて

12 月中は上記 1st ステップの実証実験を予定していますが、1−3 月中にも続けて DSP/SSP 側やブラウザの拡張機能側の実装を更新した状態で、2nd ステップの実験を予定しています。

2nd ステップにおいてメディア側で大きな手間のかかる対応が必要になる事は現時点では想定していませんが、具体的にどのような変更・対応をして頂くかは決まり次第ご連絡いたします。
