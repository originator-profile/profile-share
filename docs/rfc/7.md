# Organization Metadata Schema - Editor's Draft

## 概要

本文書では Originator Profile 技術研究組合の開発するアプリケーションで使用される組織情報のデータ構造を説明します。

## 範囲

- 本文書は Originator Profile 技術研究組合の開発するアプリケーションで使用される組織情報のデータ構造の参考情報です。
- 認証制度、資格の要件、組織の確認プロセスは本文書の範囲外です。

## 用語

本文書に説明のない用語については、用語 RFC 文書を参照してください。

- [SD-JWT VC Type Metadata](https://www.ietf.org/archive/id/draft-ietf-oauth-sd-jwt-vc-04.html#name-type-metadata)
- 認証制度: 組織を審査し、それによりその組織が一定の信頼性を持つことを保証する制度。グローバルに一意な ID を持つ。
- 認証制度ID: 認証制度のグローバルに一意な ID。
- 資格情報: ある認証制度がある組織にその認証制度の認定を与えているときに、その認証の情報をまとめた JSON Object である。

### クレーム

#### `vct`

必ず `https://originator-profile.org/organization` でなければなりません (MUST)。

#### `credentials`

REQUIRED. JSON Object の配列を含みます。必ず要素を1つ以上持つ必要があります (MUST)。

JSON Object は次のプロパティを含みます。

- `id`: REQUIRED. 認定制度の ID。グローバルに一意な ID を持ちます。
- `url`: REQUIRED. 資格情報の URL. url からは JSON Schema の `#/$defs/credential` のフォーマットの JSON Object が得られなければならない (MUST)。 url の参照先はこの OP を発行したレジストリでなければならない (MUST)。
- `url#integrity`: REQUIRED. `url` プロパティから得られる JSON の integrity metadata.

OP レジストリは、 `url` から提供するデータを変えてはいけません (MUST NOT)。データを更新したい場合には、新しいデータを別の URL で提供し、そのデータを使う OP ではその URL を `url` プロパティに指定してください。

:::note

url の参照先はこの OP を発行したレジストリでなければならない (MUST)。その理由は:

- 資格情報の発行者/定義を書くものが本当にその資格の発行/管理者である事を検証する技術的な手段がなく、OPR に登録させることで OPR が確認した資格情報管理者である事を担保可能になるから
- 資格情報発行者がいつでも任意に資格の記載を書き換えられるというのは、資格発行者が悪意あるものに買収されるケースなどに事故が起きるし、不適切な記述が入ることを防ぐ仕組みが必要であり、OPR による審査を経た記述のみが許される形にすべきであるから

https://github.com/originator-profile/profile/pull/1414#discussion_r1645333869

:::

##### 資格情報の `issuedAt`

資格情報の `issuedAt` には、その資格情報の発行日時を含めなければなりません (MUST)。資格の認定を継続して受けているときには、途中での更新があっても最初の発行日時にしてください　(MUST)。

#### `issuer`

REQUIRED. OP を発行した `organization` です。

#### `holder`

REQUIRED. OP を保有している `organization` です。

### モデル

#### `organization`

組織の情報を表す JSON Object です。

##### `country`

組織の所在地の国・地域です。
必ず [ISO 3166-1 alpha-2](https://www.iso.org/iso-3166-country-codes.html) 形式でなければなりません (MUST)。

:::note
組織の所在地の国・地域によってプロパティが異なる可能性ありますが、本仕様が書かれた時点では `country` が `JP` （日本）のみ定義しています。
:::

::: note

次のプロパティは検討中です。[コメント - OP レジストリ登録の最低要件(基本情報/確認事項)の定義](https://github.com/originator-profile/profile-governance/issues/20#issuecomment-2177454283)

- `businessCategory`: 事業種目。日本では日本標準産業分類を使用するが、地域別に適切な分類を使用する必要がある。また、分類が有用なケースが未確認。
- _未定義_: 公表している OP 憲章「発信者ポリシー」の URL
- 配下の組織 (部署)、メディア、ブランドを表明するメタデータ [1つの法人 ID に複数の OP ID を発行することを許容する](https://github.com/originator-profile/profile/issues/1444)

:::

#### `description`

説明を表す JSON Object です。 SOP を表示するアプリケーションは、このプロパティを表示するとき、`type` プロパティで指定したフォーマットで `text` プロパティのデータを解釈し表示しなければなりません (MUST)。 `type` プロパティには [media type](https://www.iana.org/assignments/media-types/media-types.xhtml) の一部の値が許可され、`text/plain` でなければなりません (MUST)。他の media type が将来的に許可される可能性があります。

`text` プロパティの文字列の長さは、`type` が `text/plain` の場合 X （何か大きい数） 以下でなければなりません (MUST)。レジストリは、 SOP を表示するアプリケーションがこのクレームを表示することを考慮して、長すぎる値には修正を求めることが推奨されます (RECOMMENDED)。

:::note

どのような長さを許容するかについてはガイドラインを発行する予定です。実験・実運用によって適切な上限が見えてきた段階でハードリミットとして仕様に定義します。

参考: [コメント - 組織情報画面のdescription領域における表示位置・順序や記載可能内容の要件定義](https://github.com/originator-profile/profile-governance/issues/27#issuecomment-2181911665)

:::

## SD-JWT VC Type Metadata

_本セクションは参考情報です。_

SD-JWT VC Type Metadata の具体例を次に示します。

```json
{
  "vct": "https://originator-profile.org/organization",
  "title": "Organization Metadata",
  "description": "A credential format to describe and assert the originator of web content and its reliability and authenticity",
  "schema": {
    "$schema": "https://json-schema.org/draft/2019-09/schema",
    "title": "Organization Metadata",
    "type": "object",
    "additionalProperties": true,
    "$defs": {
      "description": {
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "type": {
            "title": "説明のフォーマット",
            "type": "string",
            "enum": ["text/plain"]
          },
          "data": {
            "title": "説明",
            "type": "string",
            "maxLength": 10000
          }
        }
      },
      "organizationJP": {
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "domain_name": {
            "title": "ドメイン名 (RFC 4501)",
            "type": "string"
          },
          "url": {
            "title": "ウェブサイトのURL",
            "type": "string"
          },
          "logo": {
            "title": "ロゴ画像URL",
            "type": "string"
          },
          "logo#integrity": {
            "title": "Integrity Metadata",
            "description": "https://www.w3.org/TR/SRI/#framework",
            "type": "string"
          },
          "country": {
            "title": "国",
            "type": "string",
            "description": "ISO 3166-1 alpha-2",
            "enum": ["JP"]
          },
          "name": {
            "title": "法人名",
            "type": "string"
          },
          "description": {
            "$ref": "#/$defs/description"
          },
          "corporate_number": {
            "title": "法人番号",
            "type": "string"
          },
          "email": {
            "title": "メールアドレス",
            "type": "string"
          },
          "phone_number": {
            "title": "電話番号",
            "type": "string"
          },
          "postal_code": {
            "title": "郵便番号",
            "type": "string"
          },
          "region": {
            "title": "都道府県",
            "type": "string"
          },
          "locality": {
            "title": "市区町村",
            "type": "string"
          },
          "street_address": {
            "title": "丁目番地など",
            "type": "string"
          },
          "contact_title": {
            "title": "連絡先表示名",
            "type": "string"
          },
          "contact_url": {
            "title": "連絡先URL",
            "type": "string"
          },
          "privacy_policy_title": {
            "title": "プライバシーポリシー表示名",
            "type": "string"
          },
          "privacy_policy_url": {
            "title": "プライバシーポリシーURL",
            "type": "string"
          },
          "publishing_principle_title": {
            "title": "編集ガイドライン表示名",
            "type": "string"
          },
          "publishing_principle_url": {
            "title": "編集ガイドラインURL",
            "type": "string"
          }
        },
        "required": [
          "domain_name",
          "url",
          "country",
          "name",
          "corporate_number"
        ]
      },
      "organization": {
        "oneOf": [{ "$ref": "#/$defs/organizationJP" }]
      },
      "credential": {
        "title": "資格情報",
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "issuedAt": {
            "title": "最初の発行日時",
            "type": "string",
            "format": "date-time"
          },
          "expiredAt": {
            "title": "期限切れとなる日付・時刻・秒",
            "type": "string",
            "format": "date-time"
          },
          "name": {
            "title": "認証制度名",
            "type": "string"
          },
          "description": {
            "title": "認証制度の説明",
            "$ref": "#/$defs/description"
          },
          "ref": {
            "title": "認証制度の詳細URL",
            "type": "string"
          },
          "image": {
            "title": "画像URL",
            "type": "string"
          },
          "image#integrity": {
            "title": "Integrity Metadata",
            "description": "https://www.w3.org/TR/SRI/#framework",
            "type": "string"
          },
          "certifier": {
            "$ref": "#/$defs/organization"
          },
          "verifier": {
            "$ref": "#/$defs/organization"
          }
        },
        "required": [
          "issuedAt",
          "expiredAt",
          "name",
          "description",
          "ref",
          "image",
          "image#integrity",
          "certifier",
          "verifier"
        ]
      }
    },
    "properties": {
      "locale": {
        "title": "ロケール",
        "description": "Unicode CLDR locale identifier",
        "type": "string"
      },
      "jwks": {
        "type": "object",
        "title": "発行者の公開鍵の JSON Web Key Set"
      },
      "issuer": {
        "$ref": "#/$defs/organization"
      },
      "holder": {
        "$ref": "#/$defs/organization"
      },
      "credentials": {
        "type": "array",
        "items": {
          "id": {
            "title": "認定制度の識別子",
            "type": "string"
          },
          "url": {
            "title": "資格情報のURL（ #/$defs/credential の JSON が得られる）",
            "type": "string",
            "format": "uri"
          },
          "url#integrity": {
            "title": "integrity metadata",
            "description": "https://www.w3.org/TR/SRI/#framework",
            "type": "string"
          }
        },
        "minItems": 1,
        "additionalProperties": false,
        "required": ["id", "url", "url#integrity"]
      }
    },
    "required": ["locale", "jwks", "issuer", "holder", "credentials"]
  }
}
```

Originator Profile のクレームの具体例を次に示します。

```json
{
  "vct": "https://example.org/originator_profile",
  "vct#integrity": "sha256-o2zJ6gYOeJRgHgb05xK94kKKb8SIsBebOzalI0p2Pb4",
  "iss": "https://example.org",
  "iss#integrity": "sha256-Vfeaz5AVsHE9XSJ+aDikjlQUl2FpXPKc5vh0VjMssBA",
  "jwks": {
    "keys": [
      {
        "crv": "P-256",
        "kty": "EC",
        "x": "oXjYmCzMVb8ZAWYM2s0LqlzCA4AubxfwDEDdySrtf_o",
        "y": "Tx96jtb9W0_na6FohYNKVe-7S1h2oHtxXVDV1PQWQ-4"
      }
    ]
  },
  "iat": 1680274800,
  "exp": 1743433200,
  "sub": "example.jp",
  "locale": "ja-JP",
  "issuer": {
    "domain_name": "example.org",
    "url": "https://example.org/",
    "country": "JP",
    "name": "技術研究組合 (※開発用サンプル)",
    "logo": "https://example.org/image/icon.svg",
    "logo#integrity": "sha256-RwMeCLNu5pf-zCD1GgSH1P4ewytQMuUDqt-q5jHF8XQ",
    "email": "sample@example.org",
    "phone_number": "00-0000-0000",
    "corporate_number": "8010005035933",
    "postal_code": "000-0000",
    "region": "東京都",
    "locality": "千代田区",
    "street_address": "○○○",
    "contact_title": "お問い合わせ",
    "contact_url": "https://example.org/contact",
    "privacy_policy_title": "プライバシーポリシー",
    "privacy_policy_url": "https://example.org/privacy",
    "description": {
      "type": "text/plain",
      "data": "この文章は、この組織の OP憲章へのコミットメントを表す文章です。"
    }
  },
  "holder": {
    "domain_name": "example.jp",
    "url": "https://example.jp/",
    "country": "JP",
    "name": "○○新聞社 (※開発用サンプル)",
    "logo": "https://example.jp/image/icon.svg",
    "logo#integrity": "sha256-RwMeCLNu5pf-zCD1GgSH1P4ewytQMuUDqt-q5jHF8XQ",
    "corporate_number": "0000000000000",
    "postal_code": "000-0000",
    "region": "東京都",
    "locality": "千代田区",
    "street_address": "○○○",
    "contact_title": "お問い合わせ",
    "contact_url": "https://example.jp/contact",
    "privacy_policy_title": "プライバシーポリシー",
    "privacy_policy_url": "https://example.jp/privacy",
    "publishing_principle_title": "新聞倫理綱領",
    "publishing_principle_url": "https://example.jp/statement",
    "description": {
      "type": "text/plain",
      "data": "この文章は、この組織の OP憲章へのコミットメントを表す文章です。"
    }
  },
  "credentials": [
    {
      "id": "1",
      "url": "https://oprexpt.originator-profile.org/certification-systems/1",
      "url#integrity": "sha256-RwMeCLNu5pf-zCD1GgSH1P4ewytQMuUDqt-q5jHF8XQ"
    }
  ]
}
```

https://oprexpt.originator-profile.org/certification-systems/1 に GET すると次のレスポンスが得られます。

```json
{
  "name": "○○認証 (※開発用サンプル)",
  "description": {
    "type": "text/plain",
    "data": "これは○○認証の開発用サンプルです。"
  },
  "ref": "https://example.or.jp/about",
  "image": "https://example.or.jp/credential/image.svg",
  "image#integrity": "sha256-RwMeCLNu5pf-zCD1GgSH1P4ewytQMuUDqt-q5jHF8XQ",
  "issuedAt": "2021-10-31T15:00:00.000Z",
  "expiredAt": "2024-11-31T15:00:00.000Z",
  "certifier": {
    "domain_name": "example.or.jp",
    "url": "https://example.or.jp/",
    "country": "JP",
    "name": "○○協会 (※開発用サンプル)",
    "logo": "https://example.or.jp/image/icon.svg",
    "logo#integrity": "sha256-RwMeCLNu5pf-zCD1GgSH1P4ewytQMuUDqt-q5jHF8XQ",
    "corporate_number": "0000000000000",
    "postal_code": "000-0000",
    "region": "東京都",
    "locality": "千代田区",
    "street_address": "○○○",
    "contact_title": "お問い合わせ",
    "contact_url": "https://example.or.jp/contact",
    "privacy_policy_title": "プライバシーポリシー",
    "privacy_policy_url": "https://example.or.jp/privacy"
  },
  "verifier": {
    "domain_name": "example.or.jp",
    "url": "https://example.or.jp/",
    "country": "JP",
    "name": "○○協会 (※開発用サンプル)",
    "logo": "https://example.or.jp/image/icon.svg",
    "logo#integrity": "sha256-RwMeCLNu5pf-zCD1GgSH1P4ewytQMuUDqt-q5jHF8XQ",
    "corporate_number": "0000000000000",
    "postal_code": "000-0000",
    "region": "東京都",
    "locality": "千代田区",
    "street_address": "○○○",
    "contact_title": "お問い合わせ",
    "contact_url": "https://example.or.jp/contact",
    "privacy_policy_title": "プライバシーポリシー",
    "privacy_policy_url": "https://example.or.jp/privacy"
  }
}
```

:::note
本文書では外部参照リソースの `#integrity` クレームについて、アプリケーションのユースケース次第であるため任意 (OPTIONAL) としています。
しかし Originator Profile 技術研究組合のアプリケーションの実装ではデータの完全性を保つ目的でこれらのクレーム含めることを必須 (REQUIRED) とします。

- `logo#integrity`
- `image#integrity`

:::
