# Web Assertion Set - Editor's Draft

## 概要

本文書では Originator Profile、Web Assertion を提示するための方法を説明します。

## 用語

本文書に説明のない用語については、用語 RFC 文書を参照してください。

- Originator Profile (OP)
- Web Assertion (WA)
- Web Assertion Set (WAS)

## Web Assertion Set (WAS) の形式

必ず JSON オブジェクト、または JSON オブジェクトの配列でなければなりません (MUST)。

以下のプロパティが定義されます:

- `originator`: SD-JWT VC 形式の OP (REQUIRED)
- `evidence`: SD-JWT VC の配列 (REQUIRED)
- `assertions`: SD-JWT VC 形式の WA の配列 (REQUIRED)

この他にもプロパティを追加してもよいです (MAY) が、それらは本仕様の範囲外です。

:::note

Originator Profile 技術研究組合のアプリケーションの実装では WA の属性として次のプロパティを使用します。

- `main`: 文書の中心的なトピックか否かの真偽値 (true: メインコンテンツ、false: それ以外)。デフォルト値は false です。 main が true の JSON Object の中の assertions 配列は要素数が1でなければなりません (MUST)。

:::

### `originator`

REQUIRED. SD-JWT VC 形式の OP です。
OP は必ず WA 発行者の公開鍵が含まれなければなりません (MUST)。
検証者は OP の検証を拒否するとき、WA の検証処理を拒否してもよい (MAY) です。

### `evidence`

REQUIRED. SD-JWT VC の配列です。必ず要素を1つ以上持つ必要があります (MUST)。
提示者はその OP に関連する SD-JWT VC を含め、組織情報のエビデンスの確認できる情報を提供すべき (SHOULD) です。

:::note
名称については `evidence` が適切かどうか専門家のコメントを求めます。
:::

### `assertions`

REQUIRED. SD-JWT VC 形式の WA の配列です。必ず WA を1つ以上持つ必要があります (MUST)。

### 例

単一の WA を提示する場合の WAS の具体例を次に示します。

```json
{
  "originator": "eyJ...~",
  "evidence": ["eyJ...~"],
  "assertions": ["eyJ...~"]
}
```

複数の OP と WA を提示する場合の WAS の具体例を次に示します。

```json
[
  {
    "originator": "eyJ...~",
    "evidence": ["eyJ...~"],
    "assertions": ["eyJ...~"],
    "main": true
  },
  {
    "originator": "eyJ...~",
    "evidence": ["eyJ...~"],
    "assertions": ["eyJ...~"]
  },
  ...
]
```

## 検証

_本セクションは参考情報です。_

検証者は WA を検証するために WA 発行者の公開鍵を取得する必要があります。
検証者は `originator` プロパティの OP の `jwks` クレーム内に含まれる公開鍵の中から、 `assertion` プロパティの SD-JWT ヘッダーの `kid` に一致する公開鍵を探し、それを使用して `assertions` プロパティの WA を検証します。

## Website Metadata

Web サイト全体に関するメタデータの Web Assertion の提示の起点として使用するために公開することができます (OPTIONAL)。

### Request

Website Metadata を取得する場合、定義された Well-Known URL パス `/.well-known/was.json` に HTTP GET リクエストを使用してクエリする必要があります (MUST)。

Website Metadata Request の具体例を次に示します。

```http
GET /.well-known/was.json HTTP/1.1
Host: example.com
```

ユーザーエージェントは `Accept-Language` ヘッダーを利用して WAS の言語を指定することが推奨されます (RECOMMENDED)。

:::note

実装者は `Accept-Language` リクエストヘッダーがユーザーにとってプライベートな性質があると考える情報が明らかになる (ユーザーがどの民族に属しているかなど) ことを加味してプライバシーに配慮した実装をしなければなりません。 具体的には、ログとして収集する範囲に `Accept-Language` を含めない、ログを保持する期間を定める、プライバシーポリシーによって `Accept-Language` の取扱いを明示するなどです。

:::

### Response

Website Metadata を公開する Web サイトは、Request を受け取り HTTP 200 レスポンスを返す必要があります (MUST)。
サーバーはリクエストに `Accept-Language` ヘッダーが含まれる場合、 [RFC 4647 セクション 3](https://www.rfc-editor.org/rfc/rfc4647.html#section-3) に従って WAS の言語を選択しなければなりません (MUST)。
Website Metadata Response の具体例を次に示します。

```json
{
  "originator": "eyJ...~",
  "evidence": ["eyJ...~"],
  "assertions": ["eyJ...~"]
}
```

## 付注

### Media Types Registry

- Type name: `application`
- Subtype name: `application/was+json`
- Required parameters: n/a
- Optional parameters: n/a
- Change controller: IETF

### Well-Known URI Registry

- URI suffix: `/.well-known/was.json`
- Change controller: IETF
- Specification document: Website Metadata
- Related information: (none)
