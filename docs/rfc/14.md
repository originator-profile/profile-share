# Advertisement Metadata Schema - Editor's Draft

## 概要

本文書では Originator Profile 技術研究組合の開発するアプリケーションで使用される広告メタデータの構造を説明します。

## 用語

本文書に説明のない用語については、用語 RFC 文書を参照してください。

- [SD-JWT VC Type Metadata](https://www.ietf.org/archive/id/draft-ietf-oauth-sd-jwt-vc-04.html#name-type-metadata)
- Web Assertion (WA)

## Advertisement Metadata の形式

### クレーム

#### `vct`

必ず `https://originator-profile.org/advertisement` でなければなりません (MUST)。

#### `target`

REQUIRED. Web Assertion に登録済みのクレーム。

#### `allowed_urls`

OPTIONAL. Web Assertion に登録済みのクレーム。allowed_origins と allowed_urls を両方含めてはいけません (MUST NOT)。

#### `allowed_origins`

OPTIONAL. Web Assertion に登録済みのクレーム。allowed_origins と allowed_urls を両方含めてはいけません (MUST NOT)。

### サブスキーマ

#### `advertisement`

広告を表す JSON Object です。JSON Object は次のプロパティを含みます。

- `title`: REQUIRED. コンテンツのタイトル。
- `description`: REQUIRED. コンテンツの説明（プレーンテキスト）。
- `image`: OPTIONAL. コンテンツの画像の URL。コンテンツに強い関連をもつ画像があるならば、その画像を指定するべきです (RECOMMENDED)。
- `image#integrity`: OPTIONAL. コンテンツの画像のハッシュ値を指定します。ハッシュ値の形式は [Subresource Integrity セクション 3.1](https://www.w3.org/TR/SRI/#framework) の Integrity metadata でなければなりません (MUST)。
- `categories`: OPTIONAL. IAB カテゴリータクソノミーによる分類の JSON 配列。空配列でもよい (MAY)。
- `locale`: REQUIRED. Web コンテンツのロケール。

### SD-JWT VC Type Metadata

_本セクションは参考情報です。_

Web Assertion の発行者は、このスキーマを使って広告用の Web Assertion を発行することができます (MAY)。
新しいスキーマを定義して、そのスキーマに基づく Web Assertion を発行してもよい (MAY) ですが、そのスキーマも Web Assertion の仕様に準拠している必要があります (MUST)。

SD-JWT VC Type Metadata の具体例を次に示します。

```json
{
  "vct": "https://originator-profile.org/advertisement",
  "title": "Advertisement Metadata",
  "description": "A credential format to describe and assert the advertisement of web content and its reliability and authenticity",
  "schema": {
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Advertisement Metadata",
    "allOf": [
      {
        "title": "Content Assertion",
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "vct": {
            "title": "The type of the Verifiable Credential",
            "type": "string"
          },
          "vct#integrity": {
            "type": "string",
            "description": "ハッシュ値の形式は Subresource Integrity セクション 3.1 の Integrity metadata でなければなりません (MUST)。"
          },
          "iss": {
            "title": "JWT Issuer",
            "type": "string",
            "format": "uri",
            "description": "[RFC7519#section-4.1.1](https://www.rfc-editor.org/rfc/rfc7519#section-4.1.1)"
          },
          "sub": {
            "title": "JWT Subject",
            "type": "string",
            "format": "hostname",
            "description": "[RFC7519#section-4.1.2](https://www.rfc-editor.org/rfc/rfc7519#section-4.1.2)"
          },
          "iat": {
            "title": "JWT Issued At",
            "type": "number",
            "description": "[RFC7519#section-4.1.6](https://www.rfc-editor.org/rfc/rfc7519#section-4.1.6)"
          },
          "exp": {
            "title": "JWT Expiration Time",
            "type": "number",
            "description": "[RFC7519#section-4.1.4](https://www.rfc-editor.org/rfc/rfc7519#section-4.1.4)"
          }
        },
        "required": ["vct", "vct#integrity", "iss", "sub", "iat", "exp"]
      },
      {
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "vct": {
            "type": "string",
            "const": "https://originator-profile.org/advertisement"
          },
          "target": {
            "type": "array",
            "items": {
              "title": "Target",
              "oneOf": [
                {
                  "title": "Basic Target",
                  "type": "object",
                  "additionalProperties": true,
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": ["text", "visibleText", "html"]
                    },
                    "integrity": {
                      "type": "string",
                      "description": "ハッシュ値の形式は Subresource Integrity セクション 3.1 の Integrity metadata でなければなりません (MUST)。"
                    },
                    "selector": {
                      "type": "string",
                      "description": "CSS セレクター"
                    }
                  },
                  "required": ["type", "integrity", "selector"]
                },
                {
                  "title": "External Resource Target",
                  "type": "object",
                  "additionalProperties": true,
                  "properties": {
                    "type": {
                      "type": "string",
                      "const": "externalResource"
                    },
                    "integrity": {
                      "type": "string",
                      "description": "ハッシュ値の形式は Subresource Integrity セクション 3.1 の Integrity metadata でなければなりません (MUST)。"
                    }
                  },
                  "required": ["type", "integrity"]
                }
              ]
            },
            "minItems": 1
          }
        },
        "required": ["vct", "target"],
        "oneOf": [
          {
            "properties": {
              "allowed_urls": {
                "title": "Allowed URLs",
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "uri"
                },
                "description": "この Web Assertion によって表明される情報の対象となる URL の配列です。 配列の要素の文字列は必ず [URL Pattern strings](https://urlpattern.spec.whatwg.org/) 形式でなければなりません (MUST)。"
              },
              "allowed_origins": { "enum": [] }
            },
            "required": ["allowed_urls"]
          },
          {
            "properties": {
              "allowed_urls": { "enum": [] },
              "allowed_origins": {
                "title": "Allowed Origins",
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "uri"
                },
                "description": "Web Assertion によって表明される情報の対象となる [origin](https://www.rfc-editor.org/rfc/rfc6454#section-7)"
              }
            },
            "required": ["allowed_origins"]
          }
        ]
      },
      {
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "title": {
            "type": "string",
            "description": "コンテンツのタイトル。"
          },
          "description": {
            "type": "string",
            "description": "コンテンツの説明（プレーンテキスト）。"
          },
          "image": {
            "type": "string",
            "format": "uri",
            "description": "コンテンツの画像の URL。コンテンツに強い関連をもつ画像があるならば、その画像を指定するべきです (RECOMMENDED)。"
          },
          "image#integrity": {
            "type": "string",
            "description": "コンテンツの画像のハッシュ値を指定します。ハッシュ値の形式は Subresource Integrity セクション 3.1 の Integrity metadata でなければなりません (MUST)。"
          },
          "categories": {
            "type": "array",
            "items": {
              "title": "情報カテゴリー",
              "description": "OpenRTB 2.6の Object: Site にあるcat, cattax 類似の情報カテゴリーを持つ。https://iabtechlab.com/wp-content/uploads/2022/04/OpenRTB-2-6_FINAL.pdf",
              "type": "object",
              "properties": {
                "cat": {
                  "title": "情報カテゴリーID",
                  "description": "情報カテゴリータクソノミーcattaxで示される分類におけるコードまたはID",
                  "type": "string"
                },
                "cattax": {
                  "title": "情報カテゴリータクソノミー",
                  "description": "https://github.com/InteractiveAdvertisingBureau/AdCOM/blob/master/AdCOM%20v1.0%20FINAL.md#list_categorytaxonomies",
                  "type": "number"
                },
                "name": {
                  "title": "情報カテゴリー名",
                  "description": "情報カテゴリータクソノミーcattaxで示される分類におけるカテゴリー名",
                  "type": "string"
                }
              },
              "required": ["cat"]
            },
            "description": "IAB カテゴリータクソノミーによる分類の JSON 配列。空配列でもよい (MAY)。"
          },
          "locale": {
            "type": "string",
            "description": "Web コンテンツのロケール。"
          }
        },
        "required": ["title", "description", "locale"]
      }
    ]
  }
}
```

Web Assertion のクレームの具体例を次に示します。

```json
{
  "vct": "https://originator-profile.org/advertisement",
  "vct#integrity": "sha256-o2zJ6gYOeJRgHgb05xK94kKKb8SIsBebOzalI0p2Pb4=",
  "iss": "dns:example.com",
  "sub": "78550fa7-f846-4e0f-ad5c-8d34461cb95b",
  "iat": 1680274800,
  "exp": 1743433200,
  "locale": "ja-JP",
  "title": "<広告のタイトル>",
  "description": "<広告の説明>",
  "image": "https://ad.example.com/image.png",
  "image#integrity": "sha256-Upwn7gYMuRmJlD1ZivHk876vXHzokXrwXj50VgfnMnY=",
  "allowed_origins": ["https://ad.example.com"],
  "target": [
    {
      "type": "externalResource",
      "url": "https://...",
      "integrity": "sha256-Upwn7gYMuRmJlD1ZivHk876vXHzokXrwXj50VgfnMnY="
    }
  ]
}
```
