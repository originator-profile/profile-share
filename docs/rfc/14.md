# Advertisement Metadata Schema - Editor's Draft

## 概要

本文書では Originator Profile 技術研究組合の開発するアプリケーションで使用される広告メタデータの構造を説明します。

## 用語

本文書に説明のない用語については、用語 RFC 文書を参照してください。

- [SD-JWT VC Type Metadata](https://www.ietf.org/archive/id/draft-ietf-oauth-sd-jwt-vc-04.html#name-type-metadata)
- Web Assertion (WA)

## Advertisement Metadata の形式

### クレーム

#### `vct`

必ず `https://originator-profile.org/advertisement` でなければなりません (MUST)。

#### `target`

REQUIRED. Web Assertion に登録済みのクレーム。

#### `allowed_urls`

OPTIONAL. Web Assertion に登録済みのクレーム。allowed_origins と allowed_urls を両方含めてはいけません (MUST NOT)。

#### `allowed_origins`

OPTIONAL. Web Assertion に登録済みのクレーム。allowed_origins と allowed_urls を両方含めてはいけません (MUST NOT)。

### サブスキーマ

#### `advertisement`

広告を表す JSON Object です。JSON Object は次のプロパティを含みます。

- `title`: REQUIRED. コンテンツのタイトル。
- `description`: REQUIRED. コンテンツの説明（プレーンテキスト）。
- `image`: REQUIRED. コンテンツの画像の URL。
- `image#integrity`: OPTIONAL. コンテンツの画像のハッシュ値を指定します。ハッシュ値の形式は [Subresource Integrity セクション 3.1](https://www.w3.org/TR/SRI/#framework) の Integrity metadata でなければなりません (MUST)。
- `categories`: OPTIONAL. IAB カテゴリータクソノミーによる分類の JSON 配列。空配列でもよい (MAY)。
- `locale`: REQUIRED. Web コンテンツのロケール。

### SD-JWT VC Type Metadata

_本セクションは参考情報です。_

Web Assertion の発行者は、このスキーマを使って広告用の Web Assertion を発行することができます (MAY)。
新しいスキーマを定義して、そのスキーマに基づく Web Assertion を発行してもよい (MAY) ですが、そのスキーマも Web Assertion の仕様に準拠している必要があります (MUST)。

SD-JWT VC Type Metadata の具体例を次に示します。

```json
{
  "vct": "https://originator-profile.org/advertisement",
  "title": "Advertisement Metadata",
  "description": "A credential format to describe and assert the advertisement of web content and its reliability and authenticity",
  "schema": {
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Advertisement Metadata",
    "type": "object",
    "additionalProperties": true,
    "$defs": {
      "base_target_integrity": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["text", "visibleText", "html"]
          },
          "integrity": {
            "type": "string"
          },
          "selector": {
            "type": "string"
          }
        },
        "additionalProperties": true,
        "required": ["type", "integrity", "selector"]
      },
      "external_resource_target_integrity": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["externalResource"]
          },
          "integrity": {
            "type": "string"
          },
          "url": {
            "type": "string",
            "format": "uri"
          }
        },
        "additionalProperties": true,
        "required": ["type", "integrity", "url"]
      },
      "target_integrity": {
        "oneOf": [
          { "$ref": "#/$defs/base_target_integrity" },
          { "$ref": "#/$defs/external_resource_target_integrity" }
        ]
      },
      "allowed_urls": {
        "type": "array",
        "items": {
          "type": "string",
          "format": "uri"
        }
      },
      "allowed_origins": {
        "type": "array",
        "items": {
          "type": "string",
          "format": "uri"
        }
      },
      "assertion": {
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "allowed_urls": { "$ref": "#/$defs/allowed_urls" },
          "allowed_origins": { "$ref": "#/$defs/allowed_origins" },
          "target": {
            "type": "array",
            "items": {
              "$ref": "#/$defs/target_integrity"
            },
            "minItems": 1
          }
        },
        "required": ["target"]
      },
      "advertisement": {
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "title": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "image": {
            "type": "string",
            "format": "uri"
          },
          "image#integrity": {
            "type": "string"
          },
          "categories": {
            "type": "array",
            "items": {
              "$ref": "#/$defs/category"
            }
          },
          "locale": {
            "type": "string"
          }
        },
        "required": ["title", "description", "image", "locale"]
      },
      "category": {
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "cat": {
            "title": "カテゴリー ID",
            "description": "https://github.com/InteractiveAdvertisingBureau/Taxonomies/tree/main/Content%20Taxonomies",
            "type": "string"
          },
          "cattax": {
            "title": "カテゴリータクソノミー ID",
            "description": "https://github.com/InteractiveAdvertisingBureau/AdCOM/blob/main/AdCOM%20v1.0%20FINAL.md#list_categorytaxonomies",
            "type": "string"
          },
          "name": {
            "title": "カテゴリー名",
            "type": "string"
          }
        }
      }
    },
    "allOf": [
      { "$ref": "#/$defs/assertion" },
      { "$ref": "#/$defs/advertisement" }
    ]
  }
}
```

Web Assertion のクレームの具体例を次に示します。

```json
{
  "vct": "https://originator-profile.org/advertisement",
  "vct#integrity": "sha256-o2zJ6gYOeJRgHgb05xK94kKKb8SIsBebOzalI0p2Pb4=",
  "iss": "dns:example.com",
  "sub": "78550fa7-f846-4e0f-ad5c-8d34461cb95b",
  "iat": 1680274800,
  "exp": 1743433200,
  "locale": "ja-JP",
  "title": "<広告のタイトル>",
  "description": "<広告の説明>",
  "image": "https://ad.example.com/image.png",
  "image#integrity": "sha256-Upwn7gYMuRmJlD1ZivHk876vXHzokXrwXj50VgfnMnY=",
  "allowed_origins": ["https://ad.example.com"],
  "target": [
    {
      "type": "externalResource",
      "url": "https://...",
      "integrity": "sha256-Upwn7gYMuRmJlD1ZivHk876vXHzokXrwXj50VgfnMnY="
    }
  ]
}
```
